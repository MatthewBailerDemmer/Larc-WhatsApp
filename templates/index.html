<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Casino Chat</title>

<style>

body {
    font-family: 'Segoe UI', sans-serif;
    background: radial-gradient(circle at top, #2b0000, #0d0d0d 70%);
    color: #f5f5f5;
    margin: 0;
}

/* WRAPPER */
.wrapper {
    display: flex;
    justify-content: center;
    gap: 60px;
    margin-top: 40px;
}

/* CONTAINERS */
.container {
    width: 420px;
    background: #1a1a1a;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 0 25px rgba(255, 0, 0, 0.2);
    border: 1px solid #3a0000;
}

.container h2 {
    margin-top: 0;
    text-align: center;
    color: #d4af37;
    letter-spacing: 1px;
}

/* ============================= */
/* USER TABLE + PLAYER LIST */
/* ============================= */

.user-table-container {
    margin-top: 10px;
}

.user-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 15px;
}

.user-table thead {
    background: linear-gradient(45deg, #3a0000, #5a0000);
}

.user-table th {
    padding: 12px;
    text-align: left;
    color: #d4af37;
    font-weight: bold;
    letter-spacing: 1px;
    border-bottom: 2px solid #d4af37;
}

.user-table th:last-child,
.user-table td:last-child {
    text-align: right;
}

.user-table tbody tr {
    background: #121212;
    transition: 0.3s;
    border-bottom: 1px solid #2a2a2a;
}

.user-table tbody tr:hover {
    background: #1f0000;
}

.user-table td {
    padding: 12px;
}

.user-table a {
    text-decoration: none;
    color: #ffffff;
    display: block;
    width: 100%;
    transition: 0.3s;
}

.user-table a:hover {
    color: #d4af37;
}

/* PLAYER LIST */

ul.user-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

ul.user-list li {
    display: flex;
    justify-content: space-between;
    padding: 12px;
    background: #121212;
    border-bottom: 1px solid #2a2a2a;
    transition: 0.3s;
}

ul.user-list li:hover {
    background: #1f0000;
}

.player-name {
    color: #ffffff;
}

.player-score {
    color: #d4af37;
    font-weight: bold;
}

.empty {
    text-align: center;
    color: #999;
    font-style: italic;
}

/* ============================= */
/* CHAT */
/* ============================= */

.chat-container {
    margin-top: 20px;
    border-top: 1px solid #3a0000;
    padding-top: 15px;
}

.chat-container h3 {
    text-align: center;
    margin: 0 0 12px 0;
    color: #d4af37;
}

.chat-box {
    height: 260px;
    border-radius: 10px;
    padding: 12px;
    overflow-y: auto;
    margin-bottom: 10px;
    font-size: 14px;
    background: #121212;
    display: flex;
    flex-direction: column;
    gap: 10px;
    box-shadow: inset 0 0 15px rgba(255,0,0,0.1);
}

.message {
    max-width: 75%;
    padding: 10px 14px;
    border-radius: 10px;
    display: flex;
    flex-direction: column;
    word-wrap: break-word;
    font-size: 14px;
}

.received {
    align-self: flex-start;
    background: #2a0000;
    border-left: 3px solid #d4af37;
}

.sent {
    align-self: flex-end;
    background: #003300;
    border-right: 3px solid #00cc44;
}

.sender-name {
    font-size: 11px;
    color: #d4af37;
    margin-bottom: 4px;
}

.message-text {
    color: #f5f5f5;
}

/* INPUT */

.chat-input {
    display: flex;
    gap: 6px;
}

.chat-input input {
    flex: 1;
    padding: 8px;
    border-radius: 6px;
    border: none;
    background: #222;
    color: white;
}

.chat-input button {
    padding: 8px 14px;
    cursor: pointer;
    border: none;
    border-radius: 6px;
    background: linear-gradient(45deg, #8b0000, #d4af37);
    color: white;
    font-weight: bold;
    transition: 0.3s;
}

.chat-input button:hover {
    transform: scale(1.05);
}

/* ============================= */
/* GAME CONTROLS */
/* ============================= */

.game-controls {
    margin-top: 10px;
}

.game-controls form {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}

.game-controls button {
    flex: 1;
    padding: 8px;
    cursor: pointer;
    border: none;
    border-radius: 6px;
    background: linear-gradient(45deg, #4b0000, #a00000);
    color: white;
    font-weight: bold;
    transition: 0.3s;
}

.game-controls button:hover {
    background: linear-gradient(45deg, #a00000, #d4af37);
    transform: scale(1.05);
}

/* ============================= */
/* CARD IMAGE */
/* ============================= */

.card-area {
    display: flex;
    justify-content: center;
    align-items: center;
    margin: 20px 0;
}

.card-image {
    width: 180px;
    border-radius: 12px;
    border: 3px solid #d4af37;
    box-shadow: 
        0 0 25px rgba(0,0,0,0.9),
        0 0 15px rgba(212,175,55,0.4);
    transition: 0.3s ease;
}

.card-image:hover {
    transform: scale(1.08);
    box-shadow: 
        0 0 35px rgba(0,0,0,1),
        0 0 25px rgba(212,175,55,0.7);
}

</style>
</head>
<body>

    <script>
    window.addEventListener("load", function () {
        const input = document.getElementById("focus_input");
        if (input) {
            input.focus();
        }
    });
</script>

<div class="wrapper">

    <!-- LEFT CONTAINER -->
    <div class="container">
        <h2>‚ô† Logged Users ‚ô£</h2>

        {% if logged_users %}
        <div class="user-table-container">
            <table class="user-table">
                <thead>
                    <tr>
                        <th>Username</th>
                        <th>Score</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user in logged_users %}
                    <tr>
                        <td>
                            <a href="{{ url_for('get_all_posts', user=user[1], userId=user[0], card=card) }}">
                                {{ user[1] }}
                            </a>
                        </td>
                        <td>
                            <a href="{{ url_for('get_all_posts', user=user[1], userId=user[0], card=card) }}">
                                {{ user[2] }}
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
            <div class="empty">No users logged in</div>
        {% endif %}

        <div class="chat-container">
            
            {% if message_user and message_user != "None" %}
                <h3>üé∞ Conversa com: {{ message_user }}</h3>
            {% else %}
                <h3>Selecione alguem para mandar mensagem</h3>
            {% endif %}

            <div class="chat-box">

                {% if received_message and received_message|length >= 2 and received_message != "None" %}
                    <div class="message received">
                        <div class="sender-name">{{ received_message[0] }}</div>
                        <div class="message-text">{{ received_message[1] }}</div>
                    </div>
                {% endif %}

                {% if sent_message and sent_message != "None" %}
                    <div class="message sent">
                        <div  id="chave" class="message-text">{{ sent_message }}</div>
                    </div>
                {% endif %}

            </div>

            <div class="chat-input">
                <form id="message" action="{{ url_for('get_all_posts') }}">
                    <input type="hidden" name="card" value="{{ card }}">
                    <input type="hidden" name="user" value="{{ message_user }}">
                    <input type="hidden" name="userId" value="{{ message_userId }}">
                    <input type="hidden" name="flag" value="N">
                    <input type="hidden" name="sent_message" value="{{ sent_message }}">
                    <input type="text" id="focus_input" placeholder="Digite sua mensagem" name="temp_message" value="{{ temp }}">
                    <button type="submit">Enviar</button>
                </form>
            </div>
        </div>
    </div>

    <!-- RIGHT CONTAINER -->
    <div class="container">
        <h2>üÉè Jogadores Online</h2>

        {% if players %}
            <ul class="user-list">
                {% for player in players %}
                    <li>
                        <span class="player-name">{{ player[0] }}</span>
                        <span class="player-score">{{ player[1] }}</span>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <div class="empty">No players online</div>
        {% endif %}

        <div class="chat-container">
            <h3>üé≤ Jogo</h3>

            {% if card %}
            <div class="card-area">
                <img 
                    class="card-image"
                    src="{{ url_for('static', filename='images/' + card + '.png') }}" 
                    alt="{{card}}">
            </div>
            {% endif %}

            <div class="game-controls">
                <form action="{{ url_for('get_all_posts') }}">
                    <input type="hidden" name="user" value="{{ message_user }}">
                    <input type="hidden" name="userId" value="{{ message_userId }}">
                    <input type="hidden" name="sent_message" value="{{ sent_message }}">
                    <input type="hidden" name="card" value="{{ card }}">
                    <button type="submit" name="action" value="ENTER">Entrar</button>
                    <button type="submit" name="action" value="PEGAR">Pegar Carta</button>
                    <button type="submit" name="action" value="STOP">Parar</button>
                    <button type="submit" name="action" value="QUIT">Sair</button>
                </form>
            </div>
        </div>
    </div>

</div>

<script>
    setInterval(function () {
        const form = document.getElementById("message");
        if (!form) return;

        // Atualiza flag para "S"
        const flagInput = form.querySelector("input[name='flag']");
        if (flagInput) {
            flagInput.value = "S";
        }

        form.submit();
    }, 6000);
</script>





</body>
</html>
